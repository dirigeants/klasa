This guide extends {@tutorial CreatingProviders} and aims for SQL providers. As mentioned previously, {@link Provider providers} are special pieces designed for database interaction.

## Compatibility

This piece existed during SettingGateway v1 (from 0.0.1 to 0.4.0) but got unified with normal providers after SettingGateway v2, although getting a very different behaviour and inconsistency. {@link SQLProvider SQLProviders} came back after [SettingGateway v2.2](https://github.com/dirigeants/klasa/pull/228) aiming to make a more consistent library interface as well as separating the needs from a NoSQL database with SQL databases.

> **NOTE**: This is an **advanced** tutorial, please consider downloading a provider from [klasa-pieces](https://github.com/dirigeants/klasa-pieces/tree/master/providers).

## Base Code

```javascript
const { SQLProvider, QueryBuilder } = require('klasa');

module.exports = class extends SQLProvider {

	constructor(...args) {
		super(...args, {
			name: 'providerName',
			description: 'Allows you to use DB functionality throughout Klasa'
		});

		this.qb = new QueryBuilder(this.client, {
			// A type "VARCHAR"
			VARCHAR: { name: 'VARCHAR', size: true }
		});
	}

	// All other Provider methods

	async addColumn() {
		// The addColumn method which inserts/creates a new table to the database.
	}

	async removeColumn() {
		// The removeColumn method which inserts/creates a new table to the database.
	}

};
```

The example above is a boilerplate code for a Klasa SQL Provider, complementing with all the methods from {@tutorial CreatingProviders}, interfacing with the {@link UnderstandingSettingGateway SettingGateway}.

## Helpers

The {@link SQLProvider} class provides several resources to help the developer reduce the code duplication:

- `{@link SQLProvider#parseGatewayInput SQLProvider#parseGatewayInput()}`: Converts {@link Gateway SettingGateway}'s raw input into an array of tuples being keyed as `[column, value]`.
- `{@link SQLProvider#parseInput SQLProvider#parseInput()}`: Abstracts all three overloads and returns an array of tuples being keyed as `[column, value]`.
- `{@link SQLProvider#parseValue SQLProvider#parseValue()}`: Converts a value into standard JavaScript objects, useful for SQL databases that do not cover all JavaScript primitives.
- `{@link SQLProvider#parseEntry SQLProvider#parseEntry()}`: Converts plain dotted objects into parsed objects with nested object support. Uses the helper above to parse entries, and is powered by {@link SettingGateway UnderstandingSettingGateway} to improve security and parsing speed.
- `{@link SQLProvider#stringifyValue SQLProvider#stringifyValue()}`: Stringifies any JavaScript object or primitive for later SQL parsing.

## Configuration

The configuration is inherited by {@link Provider}s, however, {@link SQLProvider}s have an extra property that needs to be defined in the constructor: {@link SQLProvider#qb}. Check next section about how to create them.

## QueryBuilder

The {@link QueryBuilder} class is a very special class. It was added in [PR#228 (SettingGateway v2.2)](https://github.com/dirigeants/klasa/pull/228) and is designed to abstract all SQL from {@tutorial UnderstandingSettingGateway SettingGateway}. The following code is an example of how it is used:

```javascript
// Create a QueryBuilder for PostgreSQL
new QueryBuilder(this.client, {
	// Declare the boolean type, with the datatype name as "BOOL"
	// and defaults false and true
	BOOLEAN: { name: 'BOOL', default: [false, true] },
	// Declare the float type, defaults to 0
	FLOAT: { name: 'DOUBLE PRECISION', default: 0 },
	// Declare the integer type, defaults to 0
	INTEGER: { name: 'INTEGER', default: 0 },
	// Declare the text type, defaults to NULL
	TEXT: { name: 'TEXT' },
	// Declare the varchar type, defaults to NULL, the property of
	// size tells QB to use VARCHAR(MAX_LENGTH)
	VARCHAR: { name: 'VARCHAR', size: true }
}, {
	// When using arrays, PG converts INTEGER to INTEGER[]. So we want
	// to append '[]' at the end of the type
	arrayWrap: (type) => `${type}[]`
});
```

## Design of QueryBuilder

Until SettingGateway v2.1, the SQL was auto-generated by the schema, however, this was not always efficient because the SQL databases often had different datatypes that are not compatible, and the ones used were "bases" (datatypes supported by the majority of SQL databases). However, the more databases we supported, the more complicated it was to support them. For example, PostgreSQL has `BOOL` where MySQL has `BIT(1)` and SQLite has `INTEGER` (0 for `false`, 1 for `true`).

Another issue with the old design was portability: you can move from NoSQL to NoSQL, or from SQL to NoSQL without issues, because the SQL schema does not change. However, moving from different SQL databases led to issues. To address this, we implemented {@link QueryBuilder} which dynamically generates the datatypes that are **most efficient** for each SQL storage database, allowing them to take advantage of their potential (no more stringified JSON or arrays in PG, yay!).

## Further Reading:

- {@tutorial CreatingCommands}
- {@tutorial CreatingEvents}
- {@tutorial CreatingExtendables}
- {@tutorial CreatingFinalizers}
- {@tutorial CreatingInhibitors}
- {@tutorial CreatingLanguages}
- {@tutorial CreatingMonitors}
- {@tutorial CreatingProviders}
- {@tutorial CreatingTasks}
